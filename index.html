<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business CRM - Pro Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .modal { background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(2px); }
        .alert-notification { animation: slideIn 0.3s ease; }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-50">
    
    <!-- AUTHENTICATION SCREEN -->
    <div id="authScreen" class="auth-container">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4">
            <div class="text-center mb-8">
                <i class="fas fa-cubes text-purple-600 text-5xl mb-4"></i>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Pro CRM Login</h1>
                <p class="text-gray-600">Sign in to access your CRM data</p>
            </div>

            <div id="authMessage" class="hidden mb-4 p-3 rounded-lg"></div>

            <!-- Sign In Form -->
            <div id="signInForm">
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">Email</label>
                    <input type="email" id="signInEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="your@email.com">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 font-medium mb-2">Password</label>
                    <input type="password" id="signInPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="••••••••">
                </div>
                <button type="button" onclick="handleSignIn()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-lg transition duration-150 mb-4">
                    <i class="fas fa-sign-in-alt mr-2"></i>Sign In
                </button>

                <div class="relative my-6">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-300"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-white text-gray-500">Or continue with</span>
                    </div>
                </div>

                <button type="button" onclick="handleGoogleSignIn()" class="w-full bg-white hover:bg-gray-50 text-gray-700 font-medium py-3 rounded-lg border border-gray-300 transition duration-150 mb-4 flex items-center justify-center">
                    <i class="fab fa-google mr-2 text-red-500"></i>Sign in with Google
                </button>

                <p class="text-center text-gray-600 text-sm mt-6">
                    Don't have an account? 
                    <button type="button" onclick="showSignUpForm()" class="text-purple-600 font-medium hover:underline">Sign up</button>
                </p>
            </div>

            <!-- Sign Up Form -->
            <div id="signUpForm" class="hidden">
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">Email</label>
                    <input type="email" id="signUpEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="your@email.com">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">Password</label>
                    <input type="password" id="signUpPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="••••••••">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 font-medium mb-2">Confirm Password</label>
                    <input type="password" id="signUpConfirmPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="••••••••">
                </div>
                <button type="button" onclick="handleSignUp()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-lg transition duration-150 mb-4">
                    <i class="fas fa-user-plus mr-2"></i>Create Account
                </button>

                <p class="text-center text-gray-600 text-sm mt-6">
                    Already have an account? 
                    <button type="button" onclick="showSignInForm()" class="text-purple-600 font-medium hover:underline">Sign in</button>
                </p>
            </div>
        </div>
    </div>

    <!-- MAIN CRM APPLICATION (keeping it short for brevity) -->
    <div id="mainApp" class="hidden min-h-screen">
        <nav class="bg-white shadow-lg sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <i class="fas fa-cubes text-purple-600 text-2xl"></i>
                        <h1 class="text-2xl font-bold text-gray-800">Pro CRM</h1>
                    </div>
                    <div class="flex space-x-4 items-center">
                        <span id="userEmail" class="text-sm text-gray-600 font-medium"></span>
                        <button onclick="signOutUser()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-xl font-medium shadow-md transition duration-150 ease-in-out">
                            <i class="fas fa-sign-out-alt mr-2"></i>Sign Out
                        </button>
                    </div>
                </div>
            </div>
        </nav>
        
        <main class="max-w-7xl mx-auto px-4 py-8">
            <h2 class="text-3xl font-extrabold text-gray-900 mb-8">Welcome to Pro CRM!</h2>
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <p class="text-gray-700 text-lg">You are successfully signed in!</p>
                <p class="text-gray-600 mt-4">Your CRM dashboard will load here.</p>
            </div>
        </main>
    </div>

    <!-- Alerts -->
    <div id="alertsContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Firebase Authentication Script -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyD1uRlRidnrrfS5OcCJyX_CJzqJ_LnVUWI",
            authDomain: "business-crm-a6416.firebaseapp.com",
            projectId: "business-crm-a6416",
            storageBucket: "business-crm-a6416.firebasestorage.app",
            messagingSenderId: "789780121298",
            appId: "1:789780121298:web:7884cb712533f29705cf0b",
            measurementId: "G-TTREW97000"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();

        // Make functions globally available
        window.handleSignIn = async function() {
            console.log('Sign In clicked');
            const email = document.getElementById('signInEmail').value.trim();
            const password = document.getElementById('signInPassword').value;

            if (!email || !password) {
                showAuthMessage('Please enter both email and password', 'error');
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);
                showAuthMessage('Successfully signed in!', 'success');
            } catch (error) {
                console.error('Sign in error:', error);
                showAuthMessage(getErrorMessage(error.code), 'error');
            }
        };

        window.handleSignUp = async function() {
            console.log('Sign Up clicked');
            const email = document.getElementById('signUpEmail').value.trim();
            const password = document.getElementById('signUpPassword').value;
            const confirmPassword = document.getElementById('signUpConfirmPassword').value;

            if (!email || !password || !confirmPassword) {
                showAuthMessage('Please fill in all fields', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showAuthMessage('Passwords do not match', 'error');
                return;
            }

            if (password.length < 6) {
                showAuthMessage('Password must be at least 6 characters', 'error');
                return;
            }

            try {
                await createUserWithEmailAndPassword(auth, email, password);
                showAuthMessage('Account created successfully!', 'success');
            } catch (error) {
                console.error('Sign up error:', error);
                showAuthMessage(getErrorMessage(error.code), 'error');
            }
        };

        window.handleGoogleSignIn = async function() {
            console.log('Google Sign In clicked');
            try {
                await signInWithPopup(auth, googleProvider);
                showAuthMessage('Successfully signed in with Google!', 'success');
            } catch (error) {
                console.error('Google sign in error:', error);
                showAuthMessage(getErrorMessage(error.code), 'error');
            }
        };

        window.signOutUser = async function() {
            if (confirm('Are you sure you want to sign out?')) {
                try {
                    await signOut(auth);
                    showAuthMessage('Successfully signed out', 'success');
                } catch (error) {
                    console.error('Sign out error:', error);
                    alert('Error signing out. Please try again.');
                }
            }
        };

        window.showSignUpForm = function() {
            document.getElementById('signInForm').classList.add('hidden');
            document.getElementById('signUpForm').classList.remove('hidden');
            clearAuthMessage();
        };

        window.showSignInForm = function() {
            document.getElementById('signUpForm').classList.add('hidden');
            document.getElementById('signInForm').classList.remove('hidden');
            clearAuthMessage();
        };

        function showAuthMessage(message, type) {
            const msgDiv = document.getElementById('authMessage');
            msgDiv.textContent = message;
            msgDiv.className = `mb-4 p-3 rounded-lg ${type === 'error' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`;
            msgDiv.classList.remove('hidden');
        }

        function clearAuthMessage() {
            document.getElementById('authMessage').classList.add('hidden');
        }

        function getErrorMessage(code) {
            const messages = {
                'auth/email-already-in-use': 'This email is already registered',
                'auth/invalid-email': 'Invalid email address',
                'auth/weak-password': 'Password is too weak',
                'auth/user-not-found': 'No account found with this email',
                'auth/wrong-password': 'Incorrect password',
                'auth/invalid-credential': 'Invalid email or password'
            };
            return messages[code] || 'An error occurred. Please try again.';
        }

        // Auth state observer
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log('User signed in:', user.email);
                document.getElementById('authScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('userEmail').textContent = user.email;
            } else {
                console.log('User signed out');
                document.getElementById('authScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }
        });

        // Enter key support
        document.addEventListener('DOMContentLoaded', () => {
            const signInPassword = document.getElementById('signInPassword');
            if (signInPassword) {
                signInPassword.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') window.handleSignIn();
                });
            }
            
            const signUpConfirmPassword = document.getElementById('signUpConfirmPassword');
            if (signUpConfirmPassword) {
                signUpConfirmPassword.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') window.handleSignUp();
                });
            }
        });

        console.log('Firebase initialized successfully');
    </script>
</body>
</html>
